## 2026-01-25
- Этикетки: размер цифр штрихкода для "Товар 58x40 ЧЗ" привязан к настройке шрифта ШК.
- Этикетки: добавлена подпись "Код ЧЗ" под QR и связана с настройкой шрифта.
- Этикетки: поле "Код ЧЗ" добавлено в список сохраняемых полей таблицы настроек.
- Этикетки: включен перенос "Код ЧЗ" внутри зоны под QR (без выхода за границы).
- Этикетки: зона "Код ЧЗ" увеличена до 4 строк, QR сокращен до 2 строк, затем размеры возвращены (QR 3 строки, код 1 строка).
- Этикетки: снята обрезка текста "Код ЧЗ" в зоне под QR.
- Этикетки: убран лимит 30 символов для поля "Код ЧЗ" при сохранении настроек.
- Этикетки: добавлен EAC PNG в правый нижний угол, увеличен на 40%, затем заменен на предоставленный файл и уменьшен на 40% (scale 0.84).
- Этикетки: добавлена строка "Арт." в верхние 6 клеток слева и связана с размером шрифта артикула.
- Этикетки: разложены поля бренд/название/цвет/состав/поставщик по зонам и включены префиксы для item_cz.
- Этикетки: добавлен перенос до 2 строк с обрезкой и выравниванием по верхней линии; префиксы "Бренд:" и "Поставщик:" для item_cz.
- Этикетки: очищен шаблон "Короб · 58x60" и развернут предпросмотр горизонтально (swap width/height).
- Этикетки: добавлены подписи размеров вдоль сторон для "Короб · 58x60" (60 мм по горизонтали, 58 мм по вертикали).
- Документация: обновлен `PROJECT_CONTEXT.md` записью об исследовании структуры проекта.
- Документация: обновлен `journal.md` записями за 2026-01-24 и 2026-01-25.

## 2026-01-24
- Документация: обновлен `journal.md` записью за 2026-01-23 (учет ЧЗ и деплой).
- Документация: добавлена запись за 2026-01-22 и подготовлено обновление на сервере.
- Этикетки: обновлен дизайн "Товар 58x40 ЧЗ" (бейдж ЧЗ и настройки QR-зоны).
- Этикетки: переработан макет "Товар 58x40 ЧЗ" под образец (разметка строк, префиксы, QR с подписью).
- Прод: залиты обновления этикетки "Товар 58x40 ЧЗ" на сервер и перезапущен `fullbox`.
- Этикетки: очищен макет "Товар 58x40 ЧЗ" и оставлена сетка 6x6 для нового дизайна.
- Прод: залит очищенный макет "Товар 58x40 ЧЗ" (сетка 6x6) и перезапущен `fullbox`.
- Этикетки: сетка макета переключалась на 10x10, затем 6x10 и 10x6 (подбор разметки).
- Этикетки: добавлена разметка под образец (блок ШК слева, QR/ЧЗ справа) на сетке 10x6.
- Этикетки: красные зоны заменены на реальные элементы (вертикальный штрихкод и QR ЧЗ).
- Этикетки: расширена зона QR на одну клетку вправо и сделан квадратный QR в доступной области.
- Этикетки: добавлена строка "Код ЧЗ" в таблицу настроек (item_cz) и QR привязан к значению.

## 2026-01-23
- Обработка: добавлено приложение `marking` для учета кодов ЧЗ по SKU/размеру и заявке.
- Обработка: реализованы API-эндпоинты для сканирования ЧЗ, сводки и импорта из Excel (A=штрихкод, B=ЧЗ).
- Обработка: добавлен блок "Коды ЧЗ" в рабочий экран с выбором позиции, сканированием, импортом и счетчиками.
- База: создана миграция `marking.0001_initial`.
- Прод: задеплоены изменения, выполнена миграция и перезапуск сервиса `fullbox`.

## 2026-01-22
- Этикетки: JSON настроек в `/labels/settings/` переведен на `json_script`, чтобы избежать поломки скриптов от небезопасного контента.
- Печать: добавлено логирование выбора принтера и расчета размеров PNG/DPI в агенте печати.
- Этикетки: увеличен масштаб html2canvas до ~203 DPI для печати на TE200.
- Этикетки: смещен блок штрихкода no-CZ вверх на 3 мм.
- Этикетки: добавлены чекбоксы включения полей и ограничение длины до 30 символов с применением в превью SKU/обработки.

## 2026-01-21
- Этикетки: добавлена проверка EAN13 и fallback на CODE128 для штрихкода, чтобы полосы гарантированно рендерились.
- Этикетки: сужен блок штрихкода и добавлены отступы по 3 мм слева/справа в режимах С ЧЗ и Без ЧЗ.
- Этикетки: добавлена кнопка печати в заголовке карточки превью; печать переведена на реальную очередь (PNG через html2canvas).
- Этикетки: добавлена карточка «Принтеры» внутри вкладки «Этикетки», синхронизированы поля выбора принтера и кнопки синхронизации.
- Принтеры: показаны «Статус печати», «Агент печати», «Последняя активность» и «Последняя ошибка».
- Принтеры: добавлен heartbeat агента (обновление статуса при опросе очереди) и привязка статуса к очереди.
- Статика: размещены vendor‑скрипты в `/static/` (jsbarcode/qrcode/html2canvas) и синхронизированы скрипт‑теги.
- Прод: правки задеплоены (копирование статики, обновление шаблона), сервис `fullbox` перезапущен.

## 2026-01-20
- Этикетки: страница `/labels/settings/` переработана в стиле кабинета главного менеджера (трехколоночный layout, новые панели, навигация).
- Этикетки: добавлены вкладки Этикетки/Сканеры/Принтеры с отображением только выбранного блока.
- Этикетки: вынесен правый блок «Настройки оборудования и этикеток», освобождено место под превью в центральной колонке.
- Этикетки: превью карточек выровнено под реальные размеры, убрано растягивание по высоте/ширине, масштаб превью увеличен в 2 раза.
- Этикетки: добавлены кнопки выбора размера (товар 58x40/короб 58x60/паллет 75x120) с показом только одной карточки.
- Этикетки: добавлен штрихкод в превью, включен режим Без ЧЗ (разметка no‑CZ).
- Этикетки: таблица параметров (текст + размер шрифта) вместо сетки полей, live‑обновление превью без перезагрузки.
- Этикетки: сохранение/обновление параметров по каждому размеру, хранение настроек в JSON.
- Этикетки: серия фиксов live‑обновления размера шрифта (inline/CSS‑vars) до корректного отображения.
- Этикетки: подогнаны зоны no‑CZ (нижняя строка +5 мм, строка «Страна/Размер» −5 мм), штрихкод закреплен внизу.
- Статика: JsBarcode/QrCode переведены на self‑hosted `/static/vendor/*`.
- Прод: изменения многократно деплоились с перезапуском сервиса `fullbox` после каждой крупной правки.

## 2026-01-19
- Изменения не фиксировались (работы по проекту не выполнялись).

## 2026-01-18
- Этикетки: добавлено приложение `labels` со страницей настроек (принтеры/сканеры/превью) и централизованной разметкой.
- Этикетки: обновлены превью для SKU и карты обработки до 58x40, добавлена ссылка на настройки из кабинета главного менеджера.
- Документация: обновлен `LABEL_PRINT.md` (описание печати и настроек).
- Обработка: при переходе в распределение по направлениям добавлено автосохранение черновика (JSON‑ответ, обработка ошибок).
- Прод: задеплоены изменения по labels и автосохранению, сервис `fullbox` перезапущен.

## 2026-01-17
- В `PROJECT_CONTEXT.md` нет записей за этот день; если были изменения — пришлите список, добавлю в журнал.

## 2026-01-16
- Обновлено отображение распределения по направлениям после сохранения: «Распределение задано», кнопки «Редактировать» и «Удалить», без выпадающего списка.
- Удалена кнопка «Посмотреть», в сводке оставлены только города (Москва, Томск, Сочи).
- Добавлены таблицы отправки по направлениям («В Москву», «В Томск», «В Сочи») под общим блоком с количеством.
- Блок «Размеры» объединен с направлениями и переименован в «Всего к обработке».
- Добавлен блок «Результаты обработки» с полями (получили/обработали/брак/недостача/куда отправили) и сохранением по каждой позиции.
- Реализована проверка: незаполненные результаты обработки блокируют закрытие заявки и показывают сообщение об ошибке.
- Добавлена кнопка возврата из карты обработки в форму обработки заявки (с сохранением контекста перехода).
- Шаблон карты обработки расширен на весь экран.
- В левую колонку добавлен блок «Доступные принтеры» с загрузкой списка с сервера.
- Добавлена компактная кнопка «Синхронизировать» и команда для синхронизации доступных принтеров.
- Создан скрипт `sync_printers.ps1` для выгрузки списка локальных принтеров и загрузки на сервер.
- Исправлено чтение `available_printers.json` с учетом BOM (utf-8-sig), чтобы список принтеров отображался.

## 2026-01-15
- Заявка на обработку: после утверждения менеджером создается задача для роли `processing_head` и заявка появляется в кабинете руководителя обработки.
- Заявка на обработку: статус после утверждения сменен на "Передано в обработку", редактирование менеджером блокируется.
- История обработки: в строке статуса "Передано в обработку" ответственный показывается как руководитель обработки.
- Кабинет руководителя обработки: убраны лишние кнопки меню (все заявки, задачи, складские остатки, карта склада, клиенты, заявка на обработку).
- Кабинет руководителя обработки: добавлена кнопка "Журнал заявок на обработку" с фильтром по типу.
- Доступ: роль `processing_head` может открывать деталку заявки на обработку.
- Доступ: роль `processing_head` может открывать журнал заявок, журнал принудительно фильтруется по типу обработки.
- Заявка на обработку: добавлена кнопка "Принять в работу" для роли склада/руководителя обработки, переход в новый шаблон обработки товара с фиксацией статуса "Взята в работу".
- Заявка на обработку: при "Взята в работу" задача для руководителя обработки не переводится в "Готово".
- Заявка на обработку: при статусе "Взята в работу" задача руководителя обработки принудительно держится в работе (не в "Готово").
- Задачи: при наличии нескольких задач на один маршрут показывается активная задача, а не выполненная.
- Задачи: статус "Взята в работу" для обработки отображается как активный (не в колонке "Готово").
- Задачи обработки: при статусе "Взята в работу" клик ведет на страницу обработки товара.
- Обработка товара: отдельный шаблон для руководителя обработки с кнопками "Завершить обработку" и "Вернуться в кабинет"; параметры обработки только для просмотра, добавлено завершение обработки со статусом "Выполнена".
- Карта обработки товара: добавлена отдельная страница для одного товара с размерами и параметрами обработки, кнопка "Открыть карту обработки" в карточке товара.
- Ричтрак: создано приложение `reachtruck` с кабинетом для водителя и мобильным интерфейсом под 4" терминал (720x1440).
- Ричтрак: задания на перемещение паллет (создание, взятие, завершение) с фиксацией в `OrderAuditEntry` (`order_type=stock_move`).
- Перемещения: при завершении задания обновляется `act_pallets.location`, новое место видно в журнале остатков и на карте склада.
- Аудит: добавлен отдельный журнал "Перемещение товара" (`/audit/moves/`).
- Роли/вход: добавлена роль `reachtruck_driver`, создан dev-пользователь `reachtruck_driver`.
- Навигация: добавлены ссылки на кабинет перемещений в кабинетах менеджера/кладовщика/руководителя обработки.
- Сотрудники: добавлен водитель ричтрака Илья Паллетов (логин `reachtruck_ilya`, пароль `1`).
- Обработка: в параметрах обработки добавлено поле "Маркетплейс" с выделением цветом.
- Обработка: распределение по направлениям расширено до режимов "Отсутствует/Файл/Задать" с формой направлений и таблицей распределения по товарам/размерам.
- Прод: изменения по распределению направлений задеплоены, сервис `fullbox` перезапущен.
- Обработка: форма распределения вынесена в отдельный полноширинный шаблон `/orders/processing/directions/` с возвратом в заявку.
- Прод: изменения по экрану распределения задеплоены, сервис `fullbox` перезапущен.
- Обработка: улучшена кликабельность кнопки построения таблицы и добавлена безопасная работа с `sessionStorage` на экране направлений.
- Прод: правки по экрану направлений задеплоены, сервис `fullbox` перезапущен.
- Обработка: исправлен JS на экране направлений (return url JSON без лишних кавычек), кнопки снова работают.
- Прод: фикс по кнопкам на экране направлений задеплоен, сервис `fullbox` перезапущен.
- Главный менеджер: добавлена страница редактирования складов маркетплейсов (WB/Ozon/Яндекс/Сбер) с сохранением в `marketplace_warehouses.json`.
- Прод: справочник складов маркетплейсов задеплоен, сервис `fullbox` перезапущен.
- Главный менеджер: добавлена синхронизация складов WB/Ozon по ключам клиента (форма выбора клиента/ID, sync endpoint, обработка ошибок).
- Прод: синхронизация для клиента "ООО \"КЕЙЗИ\"" выполнена, WB недоступен (DNS suppliers-api), Ozon вернул пустой список.

## 2026-01-14
- Заявка на обработку: добавлен отдельный шаблон редактирования для менеджера, подключен при `edit=1`.
- Заявка на обработку: статус в редактировании берется из payload заявки, а не из query-параметра.
- Деталка заявки на обработку: блок "Раскоробовка" заменен на "Параметры обработки" с выводом только заполненных значений.
- Деталка заявки на обработку: удален блок "Детали заявки" из основной колонки; правый блок "Информация" переименован в "Детали заявки".
- Редактирование менеджером: убраны лишние ссылки в левом меню (Журнал/Задачи/Складские остатки/Клиенты/Заявка на обработку).
- Прод: изменения задеплоены, сервис `fullbox` перезапущен.

## 2026-01-13
- Создано приложение `processing_head` (кабинет руководителя участка обработки), подключено в `INSTALLED_APPS` и в маршруты `/processing-head/`, добавлен отдельный шаблон кабинета.
- Добавлена роль `processing_head` в сотрудников и в карту кабинетов, обновлен `bootstrap_logins` и dev login-menu для быстрого входа.
- Применена миграция `employees.0005_alter_employee_role`, назначена роль `processing_head` сотруднику "Упаковщиков Никита" на сервере.
- Доступ клиента к заявкам ограничен его агентством (проверка в карточке заявки), другие клиенты чужие заявки не видят.
- Черновик обработки сохраняется под служебным ID (`draft-...`), номер заявки присваивается только при отправке.
- В форме обработки добавлена кнопка "Удалить черновик" для клиента, удаление возвращает в кабинет клиента.
- При отправке заявки удаляются записи черновика, чтобы нельзя было удалить отправленную заявку.
- Черновики обработки скрыты от сотрудников и недоступны в деталке заявки.
- Кабинет клиента: исправлена группировка заявок по паре (тип, номер), чтобы не смешивать заявки разных типов/клиентов.
- Кабинет клиента: черновик обработки отображается как "Черновик заявки на обработку".

## 2026-01-12
- Заявка на обработку: колонка "Параметры обработки" сделана вдвое уже (сетку 2fr/1fr), снижена минимальная ширина таблицы параметров для узкой колонки.
- Заявка на обработку: удален пустой блок под основным блоком формы.
- Заявка на обработку: удалена строка-пояснение "Поля со * обязательны" под заголовком.
- Заявка на обработку: удален заголовок "Заявка на обработку товара" в блоке формы.
- Заявка на обработку: удалена подпись "Наименование товара *" над полем ввода.
- Заявка на обработку: верхняя строка разделена на 3 зоны — слева фото, по центру поле "Наименование товара", справа кнопка "Выбрать".
- Заявка на обработку: поле "Артикул" перенесено над таблицей, колонка "Артикул товара" удалена из таблицы; при сохранении артикул прокидывается в строки остатков.
- Заявка на обработку: поле "Артикул" перемещено в строку с "Наименование товара", перед ним.
- Заявка на обработку: уменьшена высота верхнего блока (уменьшены фото, отступы и высота полей/кнопки).
- Заявка на обработку: основной блок больше не растягивается по высоте; убран лишний пустой участок под таблицей.
- Заявка на обработку: сетка формы переведена на авто-высоту (без фиксированных строк), чтобы убрать пустое место под таблицей.
- Заявка на обработку: для основного блока отключено растягивание по высоте (height auto, table-wrap без flex:1), чтобы таблица занимала ровно свой размер.
- Заявка на обработку: добавлена кнопка "Выбрать товар" в левой колонке; карточки товаров создаются по выбору, с кнопками "Изменить/Удалить", новые карточки добавляются сверху.
- Заявка на обработку: в карточке товара запрещено редактирование артикула/наименования/размера/ШК, редактируется только количество.
- Заявка на обработку: карточки товаров размещены в две колонки, ширина карточек уменьшена.
- Заявка на обработку: выбранные товары скрываются в окне выбора, чтобы нельзя было добавить одинаковый товар второй раз.
- Заявка на обработку: карточки товаров переведены на колоночную раскладку (masonry), чтобы убрать пустые промежутки между карточками.

## 2026-01-11
- Заявка на обработку: блок "Параметры обработки" переведен в 2 колонки (Параметр/Значение), убраны колонки "Да/нет" и "Опции", упрощена структура таблицы.
- Проверка на брак: вместо "Да/нет" теперь список значений 10/50/100%, выбранное значение сохраняется в `defect_percent`.
- Маркировка 58/40: перевод на выпадающий список количеств (1/2/3) с сохранением в `marking_5840_qty`.
- Маркировка 58/40 (шт/чз): список количеств (1/2), сохранение в `marking_5840_each_qty`.
- Замена бирок: выбор "чьи бирки" (Фуллбокс/Клиент) в одном поле, сохранение в `tag_owner`.
- Замена пакета: выбор типа пакета (Стандартный/Zip/Клеевой клапан/Другое) + вложенный выбор "чей пакет" (Фуллбокс/Клиент) при непустом значении.
- Упаковка в бабл пленку/термо пленку: выбор размера (Малый/Средний/Большой) вместо "Да/нет".
- Сборка набора: выбор "Кол-во" и раскрытие поля `set_qty` при выборе, иначе скрыто.
- Вложение: выбор "Кол-во" и раскрытие поля `insert_qty` при выборе, иначе скрыто.
- Распределение по направлениям: выбор "Файл" и раскрытие загрузки файла, сохранение имени файла в черновике.
- Формирование короба: список фиксированных размеров (60*4*40, 60*40*25) или "Другое" с раскрытием текстового поля `box_forming_other`.
- Прочие: комментарий скрыт за селектом "Комментарий", textarea появляется только при выборе.
- Добавлен JS-переключатель `param-extra`: скрывает/показывает вложенные поля по выбранному значению и отключает скрытые инпуты.
- Для совместимости логики статусов обновлены скрытые поля `*_needed` (выставляются в "Да", если выбран любой вариант, иначе пусто).
- UI: добавлены классы `param-value/param-extra/param-select`, уменьшена минимальная ширина таблицы параметров.
- Прод: обновлен шаблон `processing/processing.html`, сервис `fullbox` перезапущен.

## 2026-01-10
- Приемка потоком: подсветка найденной позиции желтым, блок "Сканер" скрыт; закрытые палеты отображаются значками с номером и контекстным меню (открыть/печать QR 75x120).
- Приемка потоком: запрещено одновременно держать две открытые палеты; при открытии новой закрывается или удаляется пустая предыдущая.
- Приемка потоком: удалены поля "Палета" и "Короб" над неразмещенными товарами; кнопки "Закрыть палету" и "Завершить приемку" перенесены в блок "Палеты".
- Приемка потоком: добавлена пустая строка для ручного добавления товара из номенклатуры клиента (SKU/наименование/размер отдельными полями с автоподстановкой); при сканировании неизвестного товара поиск в номенклатуре и добавление в список.
- Приемка потоком: автосоздание короба/палеты при сканировании и ручном добавлении, учет позиций сверх плана, исправлено открытие второго короба.
- Приемка потоком: завершение приемки остается на странице, закрываются короба/палеты и удаляются пустые; статус меняется на "Товар принят (с расхождениями)" (или "Товар принят"), появляется кнопка "Внести изменения" с логированием действий и кнопка "Акт приемки (печатная форма)"; в закрытом режиме скрываются красные выделения.
- Приемка потоком: кнопка печатного акта возвращает в потоковую приемку.
- Журнал заявок: убраны кнопки "Новая приемка" и "Упаковка".
- Логин: исправлен переход для авторизованного клиента (кнопка "Вход" не зависает).
- Кабинет клиента: добавлена "Заявка на обработку" с новым шаблоном и деталями, отдельный тип заказа `processing`; навигация на странице упрощена.
- Заявка на обработку: правый блок переработан в сетку 2x2, заполнен только блок исходного товара с фото 2x2 см, остальные блоки пустые.

## 2026-01-09
- Доска задач менеджера: при просмотре печати акта с подтвержденным клиентом закрываются задачи о подтверждении и заявка уходит в "Готово".
- Приемка потоком: глобальный перехват ввода сканера независимо от фокуса, поиск позиции по штрихкоду с сообщением об отсутствии.
- Приемка потоком: если товара нет в заявке, он ищется в номенклатуре клиента и добавляется в список с автодобавлением в короб.
- Приемка потоком: подсветка строки сохраняется, фокус переводится в "В короб"; скан увеличивает текущий короб без записи в поле, ручной ввод применяется по Enter/кнопке.
- Приемка потоком: автосохранение черновика (короба/палеты/активные коды), восстановление состояния, блокировка интерфейса после закрытия.
- Приемка потоком: добавлено "Убрать лишнее" в текущем коробе, уменьшение количества по введенному значению.
- Приемка потоком: если черновика нет, состояние подтягивается из акта размещения (закрытые короба/палеты).
- Заявки (карточка): убраны кнопки акт приемки/размещения, добавлена "Потоковая приемка" и печатная форма акта.
- Печатная форма акта приемки: исправлен контекст клиентского префикса, устранен 500 на `/orders/receiving/<id>/act/`.
- Клиентский кабинет (карточка заявки): убрана "Новая приемка", добавлена кнопка печатной формы акта приемки.
- Складские остатки (клиент): одинаковые позиции объединяются и показываются суммарно.

## 2026-01-08
- Приемка (клиент): авто-восстановление черновика при возврате из номенклатуры, исправлен сброс формы при наличии позиций.
- Приемка (клиент): добавлен флаг возврата из номенклатуры для корректного восстановления и предотвращения потери введенных данных.
- Приемка (клиент): автозагрузка черновика при наличии позиций в корзине, чтобы не просить подтверждение перезагрузки.
- Список клиентов: вместо Dev/Admin — кнопка "В кабинет" с корректной ссылкой в кабинеты.
- Список клиентов: обновлены шаблон и view с пробросом cabinet_url в контекст.
- Акт размещения: добавлена логика сканирования штрихкода (карта ШК, добавление в активный короб, сообщения о неизвестном ШК).
- Акт размещения: добавлена карта штрихкод?SKU для поиска позиции без ручного ввода.
- Акт размещения: сканер увеличивает фактическое количество и пишет статус о добавлении/ошибке.
- Прод: изменения задеплоены, сервис `fullbox` перезапущен.

## 2026-01-07
- Печатные формы: HTML "Акт приемки" и "МХ-1" (не Excel) с кнопками в приемке; макеты под образец, постраничное разбиение МХ-1, итоги и подписи, корректный подсчет коробов/палет, добавлен Артикул и скорректированы ширины колонок.
- Акт приемки: название документа приведено к "Акт приемки", добавлены поля и итоговый блок для менеджера/кладовщика/коробов/палет.
- Сотрудники: добавлен раздел "Сотрудники" в кабинете главного менеджера, список и форма редактирования оформлены в стиле кабинета, добавлена кнопка возврата в кабинет.
- Факсимиле: поле факсимиле сотрудников (PNG) с нормализацией размера, превью в списке/форме и подстановка подписи в печатные формы; исправлена раздача `/media/` через права на каталог.
- Карта склада: приложение `stockmap` с доступом кладовщика, таблица зон/рядов/секций/ярусов/ячеек, свободные/занятые; детальный вид ряда основного склада с цветной схемой ячеек (пустые/занятые).

## 2026-01-06
- Настройки сканера: новая страница `/scanner-settings/` с Web Serial (COM), отдельная страница Proton IMS‑2290HD_K с инструкциями и штрихкодами; кнопки добавлены в кабинеты главного менеджера и кладовщика, возврат из настроек ведет в исходный кабинет.
- Приемка товара: добавлен ввод со сканера в акт приемки (карта штрихкод→SKU, автодобавление/суммирование, сообщение о неизвестном ШК); исправлено автосохранение по Enter.
- Акт приемки: разрешено сохранять акт при пустой заявке, если фактические позиции внесены; добавлены фактические количества в журнале и карточке заявки (показываются и для заявок без плана).
- Клиентская номенклатура: в карточках SKU штрихкод показывается как SVG-штрихкод.
- Кабинет клиента: сообщения показывают полное название заявки с номером, блок сообщений со скроллом, увеличен лимит до 30.
- Заказы (клиентский режим): в шапке убраны кнопки «Журнал заявок», «Новая приемка», «Упаковка».
- Приемка (клиент): кнопка «Скачать шаблон» отдает два файла (шаблон приемки и номенклатуры) через эндпоинты `/orders/templates/*`; «Загрузить шаблон» открывает модальное окно загрузки заполненных шаблонов.

## 2026-01-05
- Заявка на упаковку перенесена в раздел "Заявки": отдельный шаблон `/orders/packing/`, детальная карточка заявки и логирование через аудит.
- Заявка на упаковку оформлена в стиле кабинета клиента, навигация упрощена; блоки "Клиент" и "Контакты" убраны, данные передаются скрыто.
- Кабинет клиента: ссылки на заявки ведут в раздел "Заявки"; после сохранения реквизитов клиент возвращается в свой кабинет.
- Клиенту разрешено редактировать собственные реквизиты и использовать автозаполнение по ИНН.
- Журнал клиентов: добавлен audit-журнал клиентов, логирование создания/изменения/архивирования и отдельная страница `/audit/clients/`.
- Реквизиты клиента: валидации обязательных ИНН/телефона/ФИО, форматирование телефона в `+7 (___) ___-__-__`.
- Карточка упаковки: восстановлена правая колонка, информация/комментарии разведены по двум блокам.
- Клиентский кабинет и журнал: черновики скрыты для не‑клиентов; сообщения фильтруются без черновиков.
- Черновики клиента: открываются в режиме редактирования, добавлены кнопки «Отправить менеджеру» и «Сохранить черновик», отправка меняет статус.
- Клиент без `?client=`: разрешен доступ к заявкам по связке `portal_user`.
- Названия заявок без товаров: добавлено отображение «Заявка на приемку без указания товара» в задачах/карточках/журнале.

## 2026-01-04
- Акт размещения: обновлен интерфейс (содержимое палеты в таблице, колонка SKU, убраны лишние боковые блоки), добавлена проверка закрытия только при распределении коробов по палетам.
- Акт размещения: уточнены статусы/подсказки, исправлены счетчики и логика активной палеты, добавлено резюме по товарам/коробам/палетам.
- Убраны внешние Google Fonts на акте размещения; добавлен favicon-роут для устранения лишних запросов.
- Кабинет клиента: скорректирована логика статусов/колонок заявок, добавлена подсветка актов, скрытие актов после просмотра.
- Журнал остатков клиента: исправлены фильтры по колонкам SKU/Название/Размер.
- Форма заявки на упаковку (в кабинете клиента): переработка стиля и возврат к виду заявки на приемку по итогам правок.

## 2026-01-03
- Складские остатки клиента: отдельный шаблон в стиле кабинета клиента, скрыты колонки хранения/короб/палета/дата и заявка, объединение строк по SKU+наименованию+размеру, фильтры-списки под заголовками и общий поиск с подсказками после 3 символов.
- Складские остатки менеджера: отдельный шаблон в стиле кабинета менеджера, фильтры-списки под Клиент/SKU/Наименование, проставлены «-» в строке фильтров для Даты/Короба/Палеты/Стеллажа/Ряда/Полки.
- Задачи менеджера: выполненные задачи больше не подсвечиваются.
- Складские остатки менеджера: добавлена кнопка возврата в кабинет.

## 2026-01-01
- Кабинет клиента: 3-колоночная сетка на всю ширину, отдельная колонка сообщений, независимый скролл в колонках; убраны лишние подписи и блоки.
- Кабинеты менеджера, кладовщика, главного менеджера и директора: единый стиль, сообщения справа, независимый скролл колонок задач, убраны лишние сводки.
- Доска задач: подсветка и пульсация задач текущего исполнителя, сортировка "Готово" по свежим, переходы по задачам-заявкам сразу в карточку заявки.
- Карточка задачи `/todo/<id>/`: новый 3-колоночный layout (действия слева, таблица по центру, комментарии справа), скролл таблицы, фиксированная шапка, зебра и вертикальные границы.
- Карточка заявки `/orders/receiving/<id>/`: обновленный layout, кнопка "Исправить заявку" доступна только менеджеру.
- Акт приемки: левый столбик с инфо и кнопками, скролл таблицы, подсвеченная шапка, зебра и вертикальные границы; подсветка совпадений (зеленый) и расхождений (розовый), автосохранение черновика, фактические количества пустые по умолчанию, добавлен телефон водителя.
- Акт размещения: стиль акта приемки, левый столбик с инфо/кнопками, список коробов/палет, кнопки добавления перенесены влево, убраны лишние заголовки в центре.

## 2025-12-30
- Акт приемки: отдельная форма с фактическими количествами, редактируемыми полями «Когда/Машина», добавлением позиций и отметкой «с расхождениями».
- Акт размещения: отдельный шаблон по коробам/палетам, переход после сохранения акта приемки.
- Карточка заявки: кнопки «Открыть акт приемки / с расхождениями» и «Открыть/Создать акт размещения».
- Задачи склада: кладовщик проходит акты приемки/размещения, после размещения задача кладовщика закрывается и создается задача менеджеру.
- Журнал заявок: для черновиков действие «У клиента», для склада — «У кладовщика».
- Приемка: исправлено сохранение черновика, валидации обязательных полей, логика даты/времени приемки.
- Акт размещения: список неразмещенных товаров, короба/палеты с QR, выпадающие списки номенклатуры; палета может состоять из коробов и/или товаров.
- Короба: завершение формирования и просмотр состава в списке сформированных коробов.
- Карточка задачи `/todo/<id>/`: форма просмотра как в журнале заявок, история в обратном порядке с подсветкой последней записи.
- Карточка задачи и заявки: кнопки актов приемки/размещения отображаются по факту (включая акты с расхождениями).
- Менеджер: после размещения доступна отправка акта клиенту, статус заявки переводится в «Выполнена», клиент получает сообщение.

## 2025-12-26
- Кабинет клиента: блок «Заявки» увеличен и превращен в «Панель заявок» (У клиента / У менеджера / На складе / Выполнена), удалены фейковые блоки и пояснения, добавлен отдельный блок «Сообщения».
- История заявок: записи показывают актуальный статус, чат не дублируется в историю, формат даты/времени приведен к одному виду.
- Заявки на приемку: добавлена кнопка «Исправить заявку» для менеджера с подробной записью в истории и уведомлением клиента.
- Ответственные и подписи: «Индивидуальный предприниматель» сокращено до «ИП», роль «Ответственный» заменена на «Текущий ответственный», переведен тип мест (pallet → «Паллет»).
- Задачи: стиль «Ivory Gold», карточки подписаны как «Заявка на приемку товара №…», в задаче есть «Зайти в заявку» и «Вернуться в кабинет».
- Процесс приемки: менеджер подтверждает и отправляет на склад, создается задача кладовщика и статус у клиента переводится в «На складе».
- Дедлайны приемки: до 14:00 — выполнить сегодня до 18:00, после 14:00 — завтра до 13:00.
- Склад: создано приложение `sklad` с кабинетом кладовщика на базе шаблона менеджера, все тексты переведены на русский.
- Доступы: введен единый вход `/login/`, выход `/logout/`, dev-входы скрыты в проде; привязка пользователей к сотрудникам и клиентам, запрет переходов между кабинетами ролей.
- Добавлена команда `bootstrap_logins` для генерации логинов сотрудников и клиентов, список отображается на странице входа.
- Прод: изменения задеплоены, применены миграции, сервис перезапущен.

## 2025-12-25
- Кабинет менеджера `/team-manager/`: убраны кнопки Номенклатура/Синхронизация/Задачи и нижние карточки, оставлена панель задач.
- Журнал заявок `/orders/`: обновлены колонки (Тип/Действие/Статус/Клиент), убрана колонка «Ответственный», Клиент сокращается до «ИП».
- Тип заявки: «ЗП» для заявок на поставку; Действие: «В работе у менеджера Фамилия И.О.»; Статус: «На подтверждении» или «Черновик».
- Журнал заявок: показывается одна строка на заявку по записи с актуальным статусом, история остается внутри карточки заявки.
- Задачи менеджера: при отправке заявки клиентом дедлайн задается +1 сутки от момента отправки.
- Миграции: синхронизированы изменения `todo`, применена миграция `0007_alter_task_status`.
- Прод: изменения задеплоены, gunicorn перезапущен.

## 2025-12-24
- Кабинет клиента: переведен на светлый стиль «Ivory Gold» (единая палитра, кнопки, карточки, поля ввода и таблицы) во всех шаблонах client_cabinet.
- Номенклатура клиента: карточки в 2 колонки расширены, миниатюры приведены к 30×30 мм; улучшен вид dropdown выбора клиента на login-menu.
- Печать этикеток: превью запускается из разных мест и возвращается назад; добавлен вывод размера этикетки; режим печати скрывает все кроме этикетки.
- Этикетки: добавлены кнопки «с ЧЗ / без ЧЗ», режим без ЧЗ по умолчанию в print; ограничение текста 5 словами; исправлена отрисовка превью.
- Этикетка без ЧЗ: новая компоновка (4 строки), крупные «Артикул/Наименование», отдельные строки Цвет/Состав/Поставщик, 3-я строка поделена на Страна/Р‑р, 4-я строка — штрихкод на всю ширину с цифрами.
- Этикетка с ЧЗ: добавлен «Артикул» вверху; уточнены размеры (58×40 для клиента, 35×20 для SKU).
- Маркетплейсы: добавлена синхронизация Ozon (кнопка, статус, подробные ошибки), загрузка списка товаров и характеристик.
- Прод: оставлены только 3 клиента (WB/Ozon), остальное удалено; изменения задеплоены и сервис перезапущен.
- ШК/размеры: добавлено поле размера в SKUBarcode, миграция 0007 и отображение в админке.
- WB/Ozon синхронизация: сохранение соответствия размер↔штрихкод (WB по sizes[].skus, Ozon по атрибуту размера).
- Номенклатура клиента: выпадающий список размеров, авто-выбор минимального размера, смена ШК при выборе размера, корзина учитывает размер.
- Заявки на приемку: добавлена колонка «Размер», валидация выбора размера, уменьшен шрифт ШК; сохранение черновика при переходе в номенклатуру.
- Журнал заявок: последовательная нумерация заявок, детальная карточка с историей и чатом, участники и комментарии из аудита.
- Шаблоны: добавлен общий блок «Текущий пользователь» во всех кабинетах/журналах/шаблонах клиента.

## 2025-12-23
- Этикетка SKU (35x20 мм): переработана в блоки (штрихкод слева, QR в правом верхнем блоке 2x2, инфоблок по центру), добавлена поддержка переносов строк и приоритетных полей (наименование/размер/бренд), скрытие бренда при значении Nobrand.
- Этикетка SKU: добавлен EAC из изображения `eac1.png`, уменьшен и закреплен в правом нижнем углу.
- Номенклатура клиента: добавлена иконка печати этикетки в списке, автопоказ превью при `?print=1`.
- Маркетплейсы: создано приложение `market_sync`, добавлен дашборд `/market-sync/` со статусами настройки (красный/желтый/зеленый) и кнопками настройки.
- WB синхронизация: страница `/market-sync/wb/`, форма токена, кнопка «Синхронизировать», блок прогресса/результатов/ошибок; бекенд синхронизирует номенклатуру WB и обновляет SKU/штрихкоды/бренд/цвет/размер.
- Ozon настройки: страница `/market-sync/ozon/`, форма Client ID и API ключа; статус на дашборде учитывает заполненность ключей.

## 2025-12-22
- Задачи: роли постановщик/исполнитель/наблюдатель, видимость задач для всех трёх; редактирование только постановщиком; исполнитель отмечает выполнено, постановщик возвращает на доработку с комментарием; детальная карточка задачи с комментариями и файлами; панель задач добавлена во все кабинеты, включая кабинет главного менеджера.
- Канбан задач: колонки по срокам (Просрочены/Сегодня/Скоро), обязательный дедлайн с дефолтом "завтра", убраны поля маршрут/статус из формы создания.
- Медиа: подключены MEDIA_URL/MEDIA_ROOT и раздача файлов через nginx для вложений задач.
- Кабинеты/вход: активированы серые кнопки на login-menu, добавлен кабинет главного менеджера с блоком задач.
- Заявки: форма приемки (A2.2) перенесена в раздел "Заявки" `/orders/receiving/` с выбором клиента, таблицей состава поставки, документами и комментариями; маршрут из клиентского кабинета ведёт в заявки.
- Кабинет директора: добавлены кнопки "Описание проекта" и "Журнал разработки".

## 2025-12-19
- SKU: добавлены стрелки сортировки в заголовках, серверная сортировка; выпадающие фильтры по ключевым полям; живые подсказки поиска; сохранение состояния между таблицей и карточками; вертикальные границы ячеек.
- Залито на сервер (шаблоны/вью), пуш в GitHub `git@github.com:vlas47/fullbox.git` (ветка main) с действующим ключом `~/.ssh/id_ed25519`.
- Создано приложение `audit` (аудит и процессы), добавлено в INSTALLED_APPS.

## 2025-12-21
- Добавлено приложение `client_cabinet`: список клиентов (табличный/карточный режимы, фильтры, архив/актив), формы создания/редактирования с автоподстановкой реквизитов по ИНН (DaData), копирование/архивация. В меню быстрого входа отдельный блок ЛК клиента с выбором клиента; кнопка на дев-странице ведет на список.
- Клиентская номенклатура: отдельные шаблоны списка и формы, вывод только SKU выбранного клиента, действия (создать/редактировать/копия/удалить) возвращают в контур клиента, скрыт столбец клиента при фильтре. Кнопка в кабинете ведет на клиентский список.
- Форма заявки на приемку в кабинете клиента (черновик): плановая дата/время, таблица позиций с выбором SKU из номенклатуры клиента, автоподстановка названия и ШК, количества, комментарии, ожидаемое число коробов, загрузка файлов, общий комментарий. Добавлена кнопка «Заявка на приемку» в кабинете.
- Инфраструктура: настроены маршруты `client/<id>/sku/*`, `client/<id>/orders/new/`, `client/<id>/receiving/new/`; миграция `0006` для поля `archived` в клиентах; установлен `requests` для DaData; перезапуски runserver и заливка на прод.
- Журнал заявок: добавлена модель `OrderAuditEntry`, просмотр `/audit/orders/`, логирование действий приемки/упаковки. Отдельная форма заявки на упаковку (`client/<id>/packing/new/`) с полями по анкете (маркетплейсы, объем, маркировка, упаковка, файлы) и логированием в аудит. Добавлен тест сканера `/scanner-test/` (в т.ч. WebHID), кнопка проверки сканера в дев-кабинете.

## 2025-12-17
- Создано виртуальное окружение `.venv` и установлен Django 6.0.
- Сгенерирован SSH-ключ `~/.ssh/fullbox_root` для доступа к серверу.
- Добавлен публичный ключ в `~/.ssh/authorized_keys` на `root@95.163.227.182`.
- Проверено подключение к серверу по ключу.
- На сервере создана папка `/opt/fullbox`, развернут проект и зависимости установлены в `/opt/fullbox/.venv`.
- Выполнены миграции на сервере (`/opt/fullbox/fullbox/manage.py migrate`).
- Сервер очищен и подготовлен: установлены пакеты (python3-venv, pip, curl, PostgreSQL 16, libpq-dev).
- Созданы роль и база PostgreSQL (`fullbox`/`fullbox`, пароль `fullbox_db_pass`).
- На сервере развернута обновлённая версия проекта в `/opt/fullbox` с зависимостями из `requirements.txt` (psycopg добавлен).
- Применены миграции с подключением к PostgreSQL через переменные окружения `.env`.
- Запущена тестовая страница через `runserver` и проверена доступность (`curl http://127.0.0.1:8000/`).
- Добавлены переменные окружения для домена `kondelyabr.ru` (`ALLOWED_HOSTS`) и отключён DEBUG в `.env`; проверка `https://kondelyabr.ru/` возвращает страницу без ошибки DisallowedHost.
- Создано приложение `sku`: модели SKU, штрихкоды, фото, привязки к маркетплейсам; админ-интерфейс.
- Добавлена страница списка SKU `/sku/` (поиск по артикулу/названию/ШК).
- Миграции `sku` применены на сервере; `runserver` перезапущен.
- Добавлена главная страница (landing) с промо услуг фулфилмента в стиле Lamborghini; маршрут '/' подключён.
- Создано приложение `orders` с вкладками (Журнал, Приемка, Обработка, Отгрузка, Прочее, На главную); страница `/orders/` по умолчанию показывает Журнал.
- Создано приложение `employees` с ролью выбора (администратор, директор, бухгалтер, главный менеджер, менеджер, кладовщик, сборщик); модель зарегистрирована в админке.
- Миграция employees применена на сервере, runserver перезапущен.
- В роли сотрудников добавлен 'Разработчик'; миграция employees применена на сервере, сервис перезапущен.
- Добавлен dev login-menu `/login-menu/` (стиль Lamborghini) с кнопками для быстрого входа пользователями ролей; маршруты `login-menu` и `dev-login/<username>/` настроены.
- Панель разработчика вынесена в отдельную страницу `/dev/`; блок убран с главной. Быстрые ссылки: dev вход, SKU, заявки, сотрудники, админка.
- Добавлены кабинеты для ролей: /cabinet/<role>/ (директор, бухгалтер, главный менеджер, менеджер, кладовщик, сборщик, разработчик и др.); dev-login перенаправляет на нужный кабинет, админ — в /admin/, developer — в /dev/.
- Обновлена страница SKU `/sku/` в стиле сайта: переключатель Таблица/Карточки, сохранение поиска, карточный вид с ВГХ/ШК/фото.
- Кнопка 'Главный менеджер' в dev login теперь активна и ведёт через dev-login в кабинет главного менеджера (/head-manager/); изменения задеплоены на сервер, runserver перезапущен.
- Создано приложение \	odo\ (Задачи): список/создание/редактирование/удаление с полями статус/приоритет/дедлайн, ссылка добавлена в кабинет разработчика; миграции применены на сервере, runserver перезапущен.
в
